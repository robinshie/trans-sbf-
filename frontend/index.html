<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="AIé©±åŠ¨çš„æ™ºèƒ½ç¿»è¯‘åŠ©æ‰‹ï¼Œæ”¯æŒPDFæ–‡æ¡£ç¿»è¯‘å’Œå®æ—¶å¯¹è¯">
    <meta name="theme-color" content="#ffffff">
    <title>AI ç¿»è¯‘åŠ©æ‰‹ | æ™ºèƒ½æ–‡æ¡£ç¿»è¯‘</title>
    <!-- ç½‘ç«™å›¾æ ‡ -->
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <script type="text/javascript" async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/animations.css">
    
    <!-- JavaScript æ¨¡å— -->
    <script type="module">
        import { app } from './js/app.js';
        import { ui } from './js/ui.js';
        import { chat } from './js/chat.js';
        import { fileHandler } from './js/fileHandler.js';

        // ç­‰å¾… DOM åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.info('Initializing application...');
                await app.init();
                console.info('Application initialized successfully');
            } catch (error) {
                console.error('Failed to initialize application:', error);
                ui.showNotification('åº”ç”¨ç¨‹åºåˆå§‹åŒ–å¤±è´¥', 'error');
            }
        });
    </script>
</head>

<body class="theme-transition">
    <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="loadingIndicator" class="loading-indicator" role="progressbar" aria-hidden="true">
        <div class="spinner"></div>
    </div>

    <!-- ä¸»åº”ç”¨å®¹å™¨ -->
    <div class="app-container">
        <!-- å·¦ä¾§é…ç½®é¢æ¿ -->
        <aside class="config-panel" role="complementary" aria-label="é…ç½®é¢æ¿">
            <!-- æ¨¡å‹é€‰æ‹© -->
            <div class="header-actions">
                <button id="themeToggle" 
                        class="icon-button" 
                        aria-label="åˆ‡æ¢ä¸»é¢˜"
                        title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-moon emoji-class">ğŸ˜€</i>
                </button>
            </div>
            <section class="config-section" aria-labelledby="modelConfigTitle">
                <h2 id="modelConfigTitle" class="section-title">æ¨¡å‹é…ç½®</h2>
                <div class="model-selector">
                    <div class="select-group">
                        <select id="manufacturerSelect" class="select-input" aria-label="é€‰æ‹©æ¨¡å‹å‚å•†">
                            <option value="" disabled selected>é€‰æ‹©æ¨¡å‹å‚å•†</option>
                        </select>
                    </div>
                    <div class="select-group">
                        <select id="modelSelect" class="select-input" aria-label="é€‰æ‹©æ¨¡å‹">
                            <option value="" disabled selected>é€‰æ‹©æ¨¡å‹</option>
                        </select>
                    </div>
                </div>
                <div id="modelInfo" class="model-info" aria-live="polite"></div>
            </section>

            <!-- æ¨¡æ¿é…ç½® -->
            <section class="config-section" aria-labelledby="templateConfigTitle">
                <h2 id="templateConfigTitle" class="section-title">æ¨¡æ¿é…ç½®</h2>
                <div class="template-selector">
                    <div class="select-group">
                        <label for="templateTypeSelect">æ¨¡æ¿ç±»å‹</label>
                        <select id="templateTypeSelect" class="select-input" aria-label="é€‰æ‹©æ¨¡æ¿ç±»å‹">
                            <option value="" disabled selected>é€‰æ‹©æ¨¡æ¿ç±»å‹</option>
                        </select>
                    </div>
                    <div class="select-group">
                        <label for="templateSubtypeSelect">å­ç±»å‹</label>
                        <select id="templateSubtypeSelect" class="select-input" aria-label="é€‰æ‹©å­ç±»å‹">
                            <option value="" disabled selected>é€‰æ‹©å­ç±»å‹</option>
                        </select>
                    </div>
                    <div class="template-content">
                        <label for="templateContent">æ¨¡æ¿å†…å®¹</label>
                        <textarea id="templateContent" class="template-textarea" aria-label="æ¨¡æ¿å†…å®¹" readonly></textarea>
                    </div>
                    <div id="template-vars" class="template-vars" aria-label="æ¨¡æ¿å˜é‡"></div>
                </div>
            </section>

            <!-- æ–‡ä»¶ä¸Šä¼  -->
            <section class="config-section" aria-labelledby="uploadTitle">
                <h2 id="uploadTitle" class="section-title">æ–‡ä»¶ä¸Šä¼ </h2>
                <div class="file-upload">
                    <div class="drop-zone" 
                         id="dropZone" 
                         role="button"
                         tabindex="0"
                         aria-label="æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ">
                        <i class="fas fa-file-pdf emoji-class">ğŸ‰</i>
                        <div class="drop-zone-text">
                            <span class="primary-text">æ‹–æ‹½PDFæ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </span>
                            <span class="secondary-text">æ”¯æŒ .pdf æ ¼å¼ï¼Œæœ€å¤§20MB</span>
                        </div>
                        <input type="file" 
                               id="fileInput" 
                               accept=".pdf"
                               aria-label="é€‰æ‹©PDFæ–‡ä»¶"
                               class="file-input">
                    </div>
                </div>
                <div id="latex-ragain">
                    <h2>LaTeX Input</h2>
                    <input type="text" id="latexInput" placeholder="Enter LaTeX here" />
                    <div id="latexContent" class="template-textarea" aria-label="Latex"></div>
                </div>
            </section>
        </aside>

        <!-- ä¸­é—´PDFæ˜¾ç¤ºåŒº -->
        <main class="main-panel" role="main">
            <div class="pdf-container">
                <iframe id="pdfViewer" 
                        class="pdf-viewer"
                        type="application/pdf"
                        width="100%"
                        height="100%"
                        frameborder="0"
                        title="PDFæŸ¥çœ‹å™¨"
                        aria-label="PDFæ–‡æ¡£æ˜¾ç¤ºåŒºåŸŸ"></iframe>
            </div>
        </main>

        <!-- å³ä¾§å¯¹è¯åŒº -->
        <aside class="chat-panel" role="complementary" aria-label="AIå¯¹è¯åŒºåŸŸ">
            <div id="messagesContainer" class="messages-container">
                <!-- æ¶ˆæ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
            </div>
            
            <div class="chat-input-container">
                <div class="input-wrapper" style="display: flex;">
                    <textarea id="userInput" 
                             class="message-input"
                             placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
                             rows="1"
                             aria-label="æ¶ˆæ¯è¾“å…¥æ¡†"
                             style="flex: 1; margin-right: 10px;margin-bottom: 10px;"></textarea>
                    <div class="button-group" style="display: flex; flex-direction: row; margin-bottom: 10px;">
                        <button id="sendButton" 
                                class="icon-button primary" 
                                title="å‘é€æ¶ˆæ¯"
                                aria-label="å‘é€æ¶ˆæ¯">
                            <i class="fas fa-paper-plane emoji-class">ğŸš€</i>
                        </button>
                        <button id="exportButton" 
                                class="icon-button" 
                                title="å¯¼å‡ºå¯¹è¯"
                                aria-label="å¯¼å‡ºå¯¹è¯">
                            <i class="fas fa-file-export emoji-class">ğŸ’»</i>
                        </button>
                        <button id="clearButton" 
                                class="icon-button" 
                                title="æ¸…ç©ºå¯¹è¯"
                                aria-label="æ¸…ç©ºå¯¹è¯">
                            <i class="fas fa-trash emoji-class">ğŸ”</i>
                        </button>
                        <button id="outtoolButton" 
                                class="icon-button" 
                                title="å¤–éƒ¨å·¥å…·"
                                aria-label="å¤–éƒ¨å·¥å…·">
                            <i class="fas fa-outtool emoji-class">ğŸ”—</i>
                        </button>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- é€šçŸ¥å®¹å™¨ -->
    <div id="notificationContainer" 
         class="notification-container" 
         role="alert" 
         aria-live="polite"></div>

        <script type="module">
            import { fileHandler } from './js/fileHandler.js';
            import { chat } from './js/chat.js';
            import { ui } from './js/ui.js';

            // åˆå§‹åŒ–å„ä¸ªæ¨¡å—
            document.addEventListener('DOMContentLoaded', async () => {
              try {
                // åˆå§‹åŒ–æ¨¡å—
                await fileHandler.init();
                await chat.init();
                ui.showNotification('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success');

              } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                ui.showNotification('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥', 'error');
              }
            });
        </script>
</body>
</html>
